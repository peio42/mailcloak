#!/sbin/openrc-run

name="mailcloak"
command="/usr/local/sbin/mailcloak"
command_args="/etc/mailcloak/config.yaml"
command_background="yes"
pidfile="/run/mailcloak.pid"

depend() {
  need net
  after postfix
}

start_pre() {
  checkpath -d -m 0750 -o root:postfix /etc/mailcloak
  checkpath -d -m 0750 -o root:postfix /var/lib/mailcloak
  checkpath -d -m 0755 -o root:root /usr/local/sbin
  # sockets dir already exists
}

stop_post() {
  rm -f /var/spool/postfix/private/mailcloak-policy /var/spool/postfix/private/mailcloak-socketmap
}